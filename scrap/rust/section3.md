# 第三章　基本的なデータ構造体

## 構造体

### struct

fieldの集合。（構造体のキー名と型を結びつける。）

演算子「.」で中のフィールドの値を取り出し可能。

```rust
struct book {
	title: String,
	price: i32,
	pages: i32,
	author: String,
}
```

- タプルライクなstruct

キーを省略した書き方。

```rust
struct Date(u32, u16, u16);

fn main() {
    let date = Date(1992, 11,9);
    // 1992年11月9日
    println!("{}年{}月{}日", date.0, date.1, date.2);
}
```

- ユニットライクな構造体。

フィールドそのものを持たない構造体。（空のタプルをunitと言うことから。）

こちらもほとんど使われないらしい…

### enum

列挙型。こちらは様々な言語でもお馴染みの型で、宣言したキーワードまたは値しか値を取れない型。

```rust
enum Fruits {
	Apple,
	Banana,
	Orange,
	Grape,
}

fn main() {
  // 下記のスタティックメソッドと同じ呼び方をする。Enumも静的なオブジェクトになるからか？
	let apple = Fruits::Apple;

	// そのままではprintすることは不可能。
	println!("{}", apple);
}
```

- データを持つ列挙型

列挙型は複数の型を持つことが可能。（他の言語のUnion型がEnumのみで実現できる。）

```rust
enum Fish {}

enum Meat {}

enum Vegetable {}

enum Food {
	Fish,
	Meat,
	Vegetable,
}
```

別名：tagged_union （タグ付き共用型）

→　**複数の型を組み合わせて新しい型を作り出す**ことができる。

→　「代数的データ型」を持つと言われている。

？　調べてみたが、意味を掴みかねている。要調査。

## メソッド

**関数とは異なる点に注意！**

メソッドは、**特定のデータ型に結びつく関数のこと**。

- スタティックメソッド

型そのものに結びつくメソッド。

Javaにも同じ役割のメソッドがある。このメソッドは該当の型を**インスタンス化しなくても使えるメソッド**であったので、同じ役割であると想定。

```rust
// 「::」で型からスタティックメソッドを呼び出せる。
let s = String::from("Hello World")
```

- インスタンスメソッド

ある型のインスタンスに紐づくメソッド。

スタティックメソッドと対比して、**インスタンス化しないと使用できないメソッド**であると想定。

→　想定通り、インスタンス化しないとエラーになった。

![スクリーンショット 2024-04-17 23.23.58.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/a2b7e29b-4b3b-4fb4-ad30-cce899433423/67d3ff22-d0ab-47fa-addc-d4caf32f9942/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2024-04-17_23.23.58.png)

## メモリ

（おそらく）Rustを理解する上で重要な概念。

C言語と同じく機械語に近い言語になるため、どこのメモリにデータを配置するかは非常に重要になる。

三種類のメモリを扱う。

### データメモリ

固定長、もしくは**スタティックなデータ**を配置する。

スタティック（静的）なデータとは、ライフサイクルにおいて常に存在し続けるデータで、誰でも読み取れる定数などが該当する。

（文字列も基本的には変更されないデータなので、**スタティックデータに該当**する。）

ライフサイクル中、いつでもアクセスされるため**メモリの場所が変わらない**ことが特徴。

→　非常に高速にアクセス可能

→　文字列以外の用途は少ない？グローバルな定数以外思いつかない…

### スタックメモリ

関数内で宣言された変数を配置する。

関数が呼び出されている間、メモリ上で位置が変化することがない。

→　非常に高速にアクセス可能。

### ヒープメモリ

プログラム実行中のデータを保持する。

このメモリの上にあるデータは、**追加・移動・削除・サイズ調整**が許されている。

→　メモリの場所が動く。（動的メモリ）

柔軟性を得ることができる。遅くはないが…

3つのメモリを比較すると、以下のようなイメージ

**速さ**

データメモリ　＞　スタックメモリ　＞　ヒープメモリ

**使用頻度**

ヒープメモリ　＞　スタックメモリ　＞　データメモリ

### 構造体のメモリの置き方

インスタンス化された構造体のデータは**スタックメモリ**に格納される。

構造体内のStringは、テキストを**ヒープ領域**に配置し、このテキストへの参照アドレスを**スタックメモリ**に格納する。

→　テキストはあくまで「変更の可能性があるもの」で、このテキストのメモリ上の場所（参照アドレス）は変わらないのでスタックメモリに配置される、と言う認識。